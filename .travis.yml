# Travis-CI configuration file for SuperTuxKart modified by CandyFace for Pencil2D
#
# Configuration manual:
# http://docs.travis-ci.com/user/build-configuration/
#
# How to use TravisCI with C++ (Qt Test, C++11):
# https://github.com/richelbilderbeek/travis_qmake_gcc_cpp11_qt_qtests
#
language: cpp
compiler: g++
sudo: required
dist: trusty
osx_sdk: macosx10.12
os:
  - linux

env:
  global:
    - DOXYFILE: $TRAVIS_BUILD_DIR/util/docs/Doxyfile-Travis
    - GH_REPO_REF: github.com/pencil2d/pencil-docs.git
    - DOXYGEN_OUTPUT_DIR: $TRAVIS_BUILD_DIR/docs

python:
  - "3.4"

addons:
  apt:
    sources:
      - ubuntu-toolchain-r-test
      - ubuntu-sdk-team
      - trusty-media
      - sourceline: 'ppa:beineri/opt-qt591-trusty'
    packages:
      - build-essential
      - qt59tools
      - qt59base
      - qt59multimedia
      - qt59svg
      - qt59xmlpatterns
      - bsdtar
      - ffmpeg
      - doxygen
      - doxygen-doc
      - doxygen-latex
      - doxygen-gui
      - graphviz
      - python3
      - python3-pip

before_install:
  - |
    if [ "$TRAVIS_OS_NAME" == "osx" ]; then
        brew update;
        ver=$(python -V 2>&1 | sed 's/.* \([0-9]\).\([0-9]\).*/\1\2/');
        python -V
        if [ "$ver" -le "27" ]; then
            brew upgrade python;
        fi
        brew install p7zip;
        brew install https://raw.githubusercontent.com/Homebrew/homebrew-core/13d52537d1e0e5f913de46390123436d220035f6/Formula/qt.rb;
        brew link qt --force;
    fi
  - . $TRAVIS_BUILD_DIR/util/build-linux.sh before_install

install:
  - . $TRAVIS_BUILD_DIR/util/build-linux.sh install

before_script:
  - . $TRAVIS_BUILD_DIR/util/build-linux.sh before_script

script:
  - . $TRAVIS_BUILD_DIR/util/build-linux.sh script

after_success:
  - . $TRAVIS_BUILD_DIR/util/build-linux.sh after_success
